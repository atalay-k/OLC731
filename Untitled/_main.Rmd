---
title: Introduction
author: Author
chapter: 1
in_context: True
knit: iheiddown::chapter_pdf
abstract: |
  In this chapter, I'll introduce how to write basic text using markdown.
  It is super simple, as you will see. You just write normal text,
  but then indicate where you want certain formatting with some very basic 'markup'.
output: iheiddown::chapter_pdf
---

\setcounter{chapter}{0}
# Introduction {#intro}

Here is a brief introduction into using *RMarkdown*.
_Markdown_ is a simple formatting syntax for authoring HTML, PDF, and MS Word documents.
_RMarkdown_ provides the flexibility of _Markdown_ with the implementation of **R** input and output.
For more details on using _RMarkdown_ see <https://rmarkdown.rstudio.com>.

## Commenting

<!-- 
If you'd like to include a comment that won't be produced in your resulting file 
enclose it in a block like this.
-->

<!-- If it's just a single line, you can wrap it like this. -->

As you can see in the final PDF, the above comments are not printed.
This can be hugely helpful for keeping notes for yourself
right where you need them.
I'll be using them to add some notes for you about the functionality in this package.

<!--
The {#intro} text after the chapter declaration will allow us to link throughout the document back to the beginning of Chapter 1.  
These labels will automatically be generated (if not specified) by changing the spaces to hyphens and capital letters to lowercase.  
Look for the reference to this label at the beginning of Chapter 2.
-->

## Line breaks, paragraphs, and spacing

Generally, it's useful to write each sentence (or part of a new sentence) on a new line.
This aids in readability---for you writing, but also for your readers, who will appreciate short, succinct prose.
Any text written in the line immediately following will be included in the same paragraph.
You do not need to add a space after finishing a line.
This will be added automatically.

If you want to start a new paragraph, all you need to do is hit enter/return twice before continuing writing.
The empty line signals that the paragraph is over, and we should start a new one.

Be careful with your spacing in _Markdown_ documents though.
While whitespace largely is ignored, it does at times give _Markdown_ signals as to how to proceed.
For example, at the end of this line, I'm going to add several white spaces.   
And then I'm going to continue.  
As you will see in the final PDF, while the paragraph structure is maintained,
the standard text justification is broken.

As a habit, try to keep everything left aligned whenever possible, especially as you type a new paragraph.
In other words, there is no need to indent basic text in the Rmd document 
(in fact, it might cause your text to do funny things if you do).

\vfill

If for some reason you need some extra space between paragraphs,
you can use `\vfill`.
You can force a new page with `\newpage`.

\newpage

## Quotation

Normal in-text quotations are simple enough.
Just "enclose the quotation in speech marks".
\LaTeX\ will do the hard work of parsing out what is the start and end of the quote.

If you wish to include longer quotations as a block quote,
just start a new paragraph with a > symbol preceding the first line.

> This signals that the quotation should be indented from both sides.
I can add sentences to the paragraph,
and to conclude the block quotation...

I just start another paragraph.
If you would like fancier block quotes,
just raise this as an issue [on GitHub](https://github.com/jhollway/iheiddown).

## Lists

It's easy to create a list.
It can be unordered like

* Item 1
* Item 2

or it can be ordered like

1. Item 1
4. Item 2

Note that I intentionally mislabeled Item 2 as number 4.  
_Markdown_ automatically figures this out!  
You can put any numbers in the list and it will create the list.  
Check it out below.

To create a sublist, just indent the values a bit (at least four spaces or a tab).  
(Here's one case where indentation is key!)

1. Item 1
1. Item 2
1. Item 3
    - Item 3a
    - Item 3b

## Footnotes

As you write, you might want to footnote something.^[The footnote will be in a smaller font and enumerated and placed appropriately.] 
Alternatively, you can specify the footnote yourself.[^2]


[^2]: And then write the text out at the bottom of the page/document.


<!--chapter:end:01-introduction.Rmd-->

---
title: Theory
author: Author
chapter: 2
in_context: False
knit: iheiddown::chapter_pdf
abstract: |
  This is an example of a chapter abstract.
  Ordinarily this would only be used for paper-based dissertations.
  All you need to do is add an 'abstract' line to this metadata header,
  and fill it in with your (paper) abstract.
  It is currently ignored when the entire dissertation is compiled,
  but is printed when just the chapter is compiled.
output: iheiddown::chapter_pdf
---

\setcounter{chapter}{1}
# Theory {#theory}

## Referencing

Your dissertation, and perhaps your theory/literature review chapter in particular,
will likely have plenty of citations.
Indeed, you will probably accumulate an armful of sources.
This section outlines how to assemble a bibliography and cite in text.

### Assembling a bibliography

_RMarkdown_ uses [_pandoc_](https://pandoc.org/) to build its bibliographies.
^[One nice feature of this is that, unlike using straight \LaTeX\, you won't need to do a second compile to load in references.]
*pandoc* (and \LaTeX\) rely on one or more external bibliography databases that contain all the bibliographic information
that you may use in your thesis.
In the end though, when it builds your bibliography, 
it will only create an entry for those items that you actually cite.

The required format for these bibliography database files is **BibTeX**.
**BibTeX** files are stored in a plain text file with the .bib extension.
See [this link](https://www.economics.utoronto.ca/osborne/latex/BIBTEX.HTM) for more.
I have placed an example file under the `/bib/` folder.
You can simply replace this with your own file under the same name,
or point to your file instead by changing the correct field
in the YAML header in the main .Rmd file.

There are a variety of tools available for creating these files.
For example, you may want to consider using the free and easy-to-use tool called Zotero.  
Our wonderful librarians have created documentation on [how to use Zotero](https://libguides.graduateinstitute.ch/zotero/home).

### Citing with `citr`

After creating your personal bibliographic database,
you can cite these entries in your dissertation with an `@` symbol, 
followed by the correct, unique identifier for that entry.
Let's take for example the `Darwin1859` entry that appears in the `references.bib` file in the `bib` folder.  

Standard parenthetical citations can be indicated with square brackets [@Darwin1859].
Without them, you will get a text citation.
For example, @Darwin1859 said some smart things.
If you wish to drop the name, 
say because you wish to replace it with something more fitting in the context,
you could say that Darwin's -@Darwin1859 theory of evolution is brilliant.

To cite multiple entries together, you can just concatenate the entries, 
separated by semi-colons.
For example, this package [@iheiddown2020] very much builds and relies upon the excellent work of others [@bookdown2016; @solomon2020].

You can also add page numbers and notes.
For example, you should start reading a book from the first page [@Darwin1859, p. 1],
though often all of them are good [@Darwin1859, pp. 1-502].
These need not be page numbers, but could be other suffixes.
You can add prefixes too [see @bookdown2016; cf. @solomon2020].

A more efficient way for entering these into your documents is by using the R package `citr`.
The `citr` package includes an 'addin' for RStudio that you can bind a keyboard shortcut to,
and that raises a search window where you can type author, year, or title information in to to find the required entry/ies.
It is enormously useful, particularly as your bibliography gets larger.
If you'd like to learn more, see [the README of its GitHub account](https://github.com/crsh/citr).

![Citing with citr](../figures/citr.png){ width=100%, height=45% }


\newpage

### Tips for bibliographies

- Like with thesis formatting, the sooner you start compiling your bibliography for something as large as thesis, the better. 
Typing in source after source is mind-numbing enough; do you really want to do it for hours on end in late May? 
Think of it as procrastination.
- The cite key (a citation's label) needs to be unique from the other entries.
- When you have more than one author or editor, you need to separate each author's name by the word "and" e.g. `Author = {Noble, Sam and Youngberg, Jessica},`.
- Bibliographies made using BibTeX (whether manually or using a manager) accept \LaTeX\ markup, so you can italicize and add symbols as necessary.
- To force capitalization in an article title or where all lowercase is generally used, bracket the capital letter in curly braces.
- You can add an iheiddown citation.^[@iheiddown2020] 

<!--chapter:end:02-theory.Rmd-->

---
title: Methods
author: Author
chapter: 3
in_context: False
knit: iheiddown::chapter_pdf
output: iheiddown::chapter_pdf
---

\setcounter{chapter}{2}
# Methods {#methods}

Your methods section will discuss the approach you will take for your dissertation.

## Writing up math

\TeX\ is the best way to typeset mathematics. 
Donald Knuth designed \TeX\ when he got frustrated at how long it was taking the typesetters to finish his book, 
which contained a lot of mathematics.  
One nice feature of _RMarkdown_ is its ability to read LaTeX code directly.

If you are writing a thesis that includes equations, then this section will be useful.
If not, you can just skip over or delete this section 
(you can always come back to it later by creating a new templated folder or looking at this chapter on the GitHub account online.)

### In-line expressions

First, we can include short equations into our normal text by enclosing \LaTeX\ equations in dollar signs. 
So `$\sum_{i=1}^N i$` will read $\sum_{i=1}^N i$.

### Displayed expressions

\LaTeX\ also includes the option to present mathematical expressions on one or more separate lines:

$$
\pi(\theta|X_1< y_1,\dots,X_n<y_n) \varpropto \pi(\theta) \prod_{i=1}^n\int_{-\infty}^{y_i}
   \exp\left(-\frac{(x-\theta)^2}{2\sigma^2}\right)\ dx
$$


$$
\sum_{j=1}^n (\delta\theta_j)^2 \leq \frac{\beta_i^2}{\delta_i^2 + \rho_i^2}
\left[ 2\rho_i^2 + \frac{\delta_i^2\beta_i^2}{\delta_i^2 + \rho_i^2} \right] \equiv \omega_i^2
$$

Another equation:

$$\det\left|\,\begin{matrix}%
c_0&c_1\hfill&c_2\hfill&\ldots&c_n\hfill\cr
c_1&c_2\hfill&c_3\hfill&\ldots&c_{n+1}\hfill\cr
c_2&c_3\hfill&c_4\hfill&\ldots&c_{n+2}\hfill\cr
\,\vdots\hfill&\,\vdots\hfill&
  \,\vdots\hfill&&\,\vdots\hfill\cr
c_n&c_{n+1}\hfill&c_{n+2}\hfill&\ldots&c_{2n}\hfill\cr
\end{matrix}\right|>0$$


### Model equations

One hassle is writing \LaTeX\ equations for the models you run in your analysis.
Fortunately, there is an app (sic: package) for that!
[`{Equatiomatic}`](https://github.com/datalorax/equatiomatic) takes some of the pain out of that chore.
More details can be found [here](https://datalorax.github.io/equatiomatic/articles/intro-equatiomatic.html#other-models-1).

### Symbols

Many of the symbols you will need can be found on the [Comprehensive LaTeX Symbol Guide](https://mirror.utexas.edu/ctan/info/symbols/comprehensive/symbols-letter.pdf).

\noindent Exponent or Superscript: $\mathrm{O^-}$

\noindent Subscript: $\mathrm{CH_4}$

To stack numbers or letters as in $\mathrm{Fe_2^{2+}}$, the subscript is defined first, and then the superscript is defined.

\noindent Delta: $\Delta$

<!--
The \noindent command does what you'd expect:  
it forces the current line/paragraph to not indent. 
This was done here to match the format of the LaTeX thesis PDF.
-->

You can get around math mode's automatic italicizing in \LaTeX\ by using the argument `$\mathrm{formula here}$`, 
with your formula inside the curly brackets.  
(Notice the use of the backticks here which enclose text that acts as code.)

So, $\mathrm{Fe_2^{2+}Cr_2O_4}$ is written `$\mathrm{Fe_2^{2+}Cr_2O_4}$`.

## Inline code

If you'd like to put the results of your analysis directly into your discussion, add inline code like this:

> The `cos` of $2 \pi$ is `r cos(2*pi)`. 

Another example would be the direct calculation of the standard deviation:

> The standard deviation of `speed` in `cars` is `r sd(cars$speed)`.

One last neat feature is the use of the `ifelse` conditional statement which can be used to output text depending on the result of an **R** calculation:

> `r ifelse(sd(cars$speed) < 6, "The standard deviation is less than 6.", "The standard deviation is equal to or greater than 6.")`

Note the use of `>` here, which signifies a quotation environment that will be indented.

As you see with `$2 \pi$` above, mathematics can be added by surrounding the mathematical text with dollar signs.


<!--chapter:end:03-method.Rmd-->

---
title: Results
author: Author
chapter: 4
in_context: False
knit: iheiddown::chapter_pdf
output: iheiddown::chapter_pdf
---

\setcounter{chapter}{3}
# Results {#results}

## An intro to R chunks

One of the most useful parts of _RMarkdown_ is the ability to weave or 'knit' text 
(as we've seen in the previous three chapters)
together with the code that produces tables and graphics for your final document.
This has various advantages such as:

- *coherence*: for you, having your analysis and text together means keeping a coherent story together about why you did the analysis you did, how you got to your results, and what your interpretation of these results is
- *amendability*: this gives you an opportunity to update the code, for example by filtering the data in a different way, and rerun the code to see how any statistics, tables or graphs related to the data may have changed
- *reproducibility*: this also, importantly, supports a reproducible workflow such that you, or others, can rerun and test the code at a later point

To 'knit' such text and code together, code for particular graphs or tables should first be inserted into the text in 'chunks'.
These chunks are opened with three backticks and closed in a new line with another three backticks.
The code that produces the desired output is included between these lines, 
which can include comments etc.
A key part of these chunks are the chunk parameters,
which are included in braces immediately following the first set of backticks.
The first parameter indicates the programming language.
The second parameter, 
which is optional and should be separated from the first parameter only by a space,
is a chunk label.
It is important that this chunk label includes no spaces and is unique to this chunk.
Then, separated by commas, are any additional parameters included.
In the figure below, two examples are included:
whether or not the code itself should be shown (`echo`)
and whether or not the code should be evaluated or run (`eval`).
Other parameters that we will see later include figure width, captions, etc.^[More information is available at [https://yihui.org/knitr/options/](https://yihui.org/knitr/options/).]

```{r chunk-parts, results="asis", echo=FALSE, fig.cap="Chunk parts", out.width="\\textwidth"}
knitr::include_graphics("figures/chunk-parts.png")
```

In the code chunk shown in Figure \@ref(fig:chunk-parts),
we can see that it is loading a package library.
Functions and objects loaded or created in earlier chunks are cached by default and
thus held on to for use in later chunks.
It is therefore quite common to have a chunk early on in your chapter (or even your whole dissertation)
that loads a number of the packages you need later on.
As an example, below is a short code chunk that loads a set of **R** packages that we are going to rely on
for the rest of this chapter.

```{r load_pkgs, message=FALSE}
# Load packages
library(dplyr)
library(ggplot2)
library(knitr)
```

When you click the **Knit** button above in RStudio a document will be generated that includes both content 
as well as the output of any embedded **R** code chunks within the document.
If you need a graphic or tabular material to be part of the text, you can just put it inline. 
If you need it to appear in the list of figures or tables, it should be placed in a code chunk.

In the remainder of this chapter,
we will see how to use code chunks to include figures, load and summarise data, and present results from your analysis.

## Including external figures

First, we will treat how to include figures in _RMarkdown_ in more detail.
If your thesis has a lot of figures, _RMarkdown_ might behave better for you than your usual word processor,
which can have a tendency to .
One perk is that it will automatically number the figures accordingly in each chapter.
You'll also be able to create a label for each figure, add a caption, and then reference the figure in a way similar to what we saw with tables earlier.
If you label your figures, you can move the figures around and _RMarkdown_ will automatically adjust the numbering for you.
No need for you to remember!
So that you don't have to get too far into \LaTeX\ to do this, a couple **R** functions have been created for you to assist.
You'll see their use below.

### Numbering and labelling figures

You don't need to number figures in _RMarkdown_; it'll do it automatically.
And captioning a figure is awfully easy too.
In the **R** chunk below, we will load in a picture that is stored as `iheid.png` in our `figures` directory.
The `include_graphics()` function is from the `{knitr}` package, that does most of the heavy lifting here.
We'll label the chunk 'iheidlogo' so that we can refer back to it later,
and give the figure the caption "IHEID logo".
You will see that here you do not need to include the parameter `echo=FALSE`,
as the code including the figure is hidden by default.

```{r iheidlogo, fig.cap="IHEID logo", out.width="50%", fig.align='center'}
include_graphics(path = "figures/iheid.png")
```

### Referencing figures

Referencing figures in the text should be done with a little reference to the chunk label
so that it will always refer to the right figure number, 
even if you add additional figures and plots before it.
To reference the IHEID logo use a backslash, at-symbol, and then in parentheses `fig:chunk-label`,
like so `\@ref(fig:iheidlogo)`.
Usually some descriptor like "Figure", "Fig.", "Illustration" or other is added before this reference,
so that it reads something like Figure \@ref(fig:iheidlogo).
Note that the reference is hyperlinked in the resulting PDF, 
so that you can click on it to take you to the page where the original figure is printed.

### Resizing figures

It is common to resize external image files so that they fit the format of the text.
The most common way to do this was already demonstrated in the code chunk for Figure \@ref(fig:chunk-parts) above.
There we used the parameter `out.width="\\textwidth"` to, in this case, shrink the image to the width of the text,
but this same parameter specification would also expand an image to fit the width of the text where possible.

Another option is the `out.extra` chunk option. 
This can be used to shrink or expand an image loaded from a file more specifically by specifying `"scale= "`.
Here we use the graph stored in the "subdivision.pdf" file, again found in the `figures` subdirectory.
The output can be found in Fig. \@ref(fig:subd).

```{r subd, fig.cap="Subdiv. graph", out.extra="scale=0.75"}
include_graphics("figures/subdivision.pdf")
```

We can also use the `out.extra` chunk option to enlarge figures, 
and even to rotate them any number of degrees around its axis.
In Figure \@ref(fig:subd2), we see an example where Figure \@ref(fig:subd) has been enlarged and flipped upside down.

```{r subd2, out.extra="angle=180, scale=1.1", fig.scap="Subdiv. graph flipped", fig.cap="A Larger Figure, Flipped Upside Down"}
include_graphics("figures/subdivision.pdf")
```

If you look closely at the chunk options,
you will also see that two different captions have been provided.
The `fig.scap` is a short caption that overrides the main caption, `fig.cap`, in the table of contents.
This can be very useful where, for example, you need to describe the figure in a caption over several lines,
details that do not need to be presented in the table of contents.

### Placing figures

One thing that may be annoying is the way _RMarkdown_ handles "floats" like tables and figures (it's really \LaTeX's fault). 
\LaTeX\ will try to find the best place to put your object based on the text around it and,
until you're really, truly done writing, it is best to just leave it where it lies. 
There are some optional arguments specified in the options parameter of the `label` function.
If you need to shift your figure around, it might be good to look [here](https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions) (you can click on the word 'here') on tweaking the options argument.

Spacing out your chunks between paragraphs can help, 
as it can give \LaTeX\ more options to find a suitable home for the figure or table,
as \LaTeX\ would otherwise try and keep all the text together, saving the image for later.
A last trick is to write `\clearpage` directly in your _RMarkdown_ document.
This gives \LaTeX\ a chance to catch up with all the 'floats' it has accumulated,
and starts a new page.

\clearpage 

## Loading and exploring data

Sometimes it is not an existing image that must be imported,
but instead you wish to create a table or plot of some data that you have imported.
In this section, we're going to very quickly cover how to import internal and external data,
how to manipulate and summarise the data, create plots from that data,
and tabulate inferential results from that data.

### Importing data {#import-data}

In some cases, the data you need might be available already in an **R** package.
An example below is a very short code chunk that summarises a dataset that is built into **R**.
Here it is particularly easy, as we do not even need to load the data (it is loaded by default).

```{r cars}
summary(cars)
```

Othertimes you may need to load the data first before summarising it,
with the function `data()`.
There are an increasing number of data packages for **R** available,
including several on a range of international and development topics.

The other option is to import data that resides in a file outside of **R**.
Included in this template is a file called `flights.csv`.
This file includes a subset of the larger dataset of information about all flights that departed from Seattle and Portland in 2014.^[More information about this dataset and its **R** package is available at [https://github.com/ismayc/pnwflights14](https://github.com/ismayc/pnwflights14).] 
This subset includes only Portland flights and only rows that were complete with no missing values. 
Merges were also done with the `airports` and `airlines` data sets in the `pnwflights14` package 
to get more descriptive airport and airline names.
We can load in this data set using the following commands:

```{r load_data}
# flights.csv is in the data directory
flights <- read.csv("data/flights.csv")
```

The data is now stored in the data frame called `flights` in the cached environment for this _RMarkdown_ document in **R**.
To get a better feel for the variables included in this dataset we can use a variety of functions. 
Here we can see the dimensions (rows by columns) and also the names of the columns.

```{r str}
dim(flights)
names(flights)
```

Another good idea is to take a look at the dataset in table form.
With this dataset having more than 20,000 rows, we won't explicitly show the results of the command here,
so we'll use the `eval=FALSE` chunk option to make sure the following is not run when you 'knit' the document.
Still, you can press the green play button at the right of the chunk to run the chunk on demand,
bringing up a new tab showing the data.

```{r view_flights, eval=FALSE}
View(flights)
```

\clearpage

### Manipulating and summarising data

While not required, it is highly recommended you use the `dplyr` package to manipulate and summarize your data set as needed.
It uses a syntax that is easy to understand using chaining or 'pipe' operations (`%>%`).
Below I've created a few examples of using `dplyr` to get information about the Portland flights in 2014.
The example we show here does the following:

- Selects only the `carrier_name` and `arr_delay` from the `flights` dataset and then assigns this subset to a new variable called `flights2`.
- Using `flights2`, we determine the largest arrival delay for each of the carriers.

```{r max_delays}
flights2 <- flights %>%
  select(carrier_name, arr_delay)
max_delays <- flights2 %>%
  group_by(carrier_name) %>%
  summarize(max_arr_delay = max(arr_delay, na.rm = TRUE))
```

A useful function in the `knitr` package for making nice tables in _RMarkdown_ is called `kable`.  
It is much easier to use than manually entering values into a table by copying and pasting values into Excel or \LaTeX\.
This again goes to show how nice reproducible documents can be! 
The chunk option `results="asis"` makes sure the table is produced, not the code to create the table.
Tables created with the `kable()` function (in `{knitr}`) can be extended in many useful (and pretty) ways
with the recommended `{kableExtra}` package.

```{r maxdelays, results="asis"}
kable(max_delays,
  col.names = c("Airline", "Max Arrival Delay"),
  caption = "Maximum Delays by Airline",
  caption.short = "Max Delays by Airline",
  longtable = TRUE,
  booktabs = TRUE
)
```

Note that instead of adding the caption details in the chunk options, we will be adding this in the `kable()` function,
which then passes this on up.
The `caption.short` argument is used to include a shorter title to appear in the List of Tables.
The last two options make Table \@ref(tab:maxdelays) a little easier-to-read.^[Note that we can create references/links to tables using a very similar syntax here to that with figures above. We can preface the reference with "Table" or "Tab." or so, and then create the reference with the format `\@ref(tab:chunk-label)`.]

We can further look into the properties of the largest value here for Alaska Airlines Inc.
To do so, we can isolate the row corresponding to the arrival delay of 70 minutes for Alaskan in our original `flights` dataset.
We see that the flight occurred on January 1st and departed a little after 1:30 am on its way to Anchorage.  

```{r max_props}
flights %>%
  dplyr::filter(
    arr_delay == 70,
    carrier_name == "Alaska Airlines Inc."
  ) %>%
  select(-c(
    month, day, carrier, dest_name, hour,
    minute, carrier_name, arr_delay
  ))
```

### Creating plots

Once data has been loaded or imported and manipulated or filtered as required,
a common task is to visualise some key dimensions of the data to inform the reader.
Here the package `{ggplot2}` plays nicely with `{dplyr}` and other `{tidyverse}` packages.
`{ggplot2}` produces beautiful, high-quality academic visuals,
and has been extended with a huge range of add-ons for a very broad variety of visualisation styles
no matter what kind of data you have.

We're going to continue playing with the `flights` dataset from Chapter \@ref(import-data).
First, let us show how we can visualize the arrival delay of all departing flights from Portland on March 3rd against time of departure.
Note that once you open the plotting function with `ggplot()`,
additional elements are chained not with the pipe operator `%>%` but `+`.
Considerably more help than I can offer here on how to use `ggplot()` can be found online.

```{r march3plot, fig.height=3, fig.width=6}
flights %>%
  dplyr::filter(month == 3, day == 3) %>%
  ggplot(aes(x = dep_time, y = arr_delay)) +
  geom_point()
```

Next Figure \@ref(fig:delaysboxplot) presents a bar graph with the mean flight departure delays by airline from Portland for 2014.
A table linking these carrier codes to airline names is available at [https://github.com/ismayc/pnwflights14/blob/master/data/airlines.csv](https://github.com/ismayc/pnwflights14/blob/master/data/airlines.csv).

```{r delaysboxplot, warnings=FALSE, messages=FALSE, fig.cap="Mean Delays by Airline", fig.width=6}
mean_delay_by_carrier <- flights %>%
  group_by(carrier) %>%
  summarize(mean_dep_delay = mean(dep_delay))
ggplot(mean_delay_by_carrier, aes(x = carrier, y = mean_dep_delay)) +
  geom_bar(position = "identity", stat = "identity", 
           fill = iheiddown::iheid_palette("IHEID", 1)) +
  theme_minimal()
```

You don't have to use `{ggplot2}` though.
For example, here is a way to use the base **R** graphics package to produce a plot using the built-in `pressure` dataset:

```{r pressure, echo=FALSE, cache=TRUE, fig.height=3, fig.width=5}
plot(pressure)
```

### Tabulating inferential results

Another common task researchers have is the presentation of results obtained from applying various statistical methods to their data.
Since **R** makes available a very broad range of statistical methods, 
and all too often these output objects in different structures and formats, 
there is unfortunately no single package that reliably and prettily prints results.
Still, I can offer a few suggestions here that cover as much as possible,
in addition to `{kable}` and `{kableExtra}` mentioned above.

- [`{stargazer}`](https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf) for well-formatted regression tables, with multiple models side-by-side, as well as for summary statistics tables, data frames, vectors and matrices.
- [`{xtable}`](https://cran.r-project.org/web/packages/xtable/vignettes/xtableGallery.pdf) offers a straightforward but extensible framework.
- [`{memisc}`](http://www.martin-elff.net/software/memisc/) provides tools for the management of survey data, as well as the creation of tables of summary statistics and model estimates.
- [`{Hmisc}`](https://hbiostat.org/R/Hmisc/) for data description and predictive modeling.
- [`{finalfit}`](https://finalfit.org/articles/export.html#pdf-via-knitrr-markdown) brings together the day-to-day functions we use to generate final results tables and plots when modelling.
- [`{tableone}`](https://github.com/kaz-yos/tableone) i.e., description of baseline patient characteristics.
- [`{flextable}`](https://davidgohel.github.io/flextable/) provides a framework for easily create tables for reporting and publications (PDF documents only with package `{pagedown}`).
- [`{huxtable}`](https://hughjonesd.github.io/huxtable/) creates LaTeX and HTML tables with a friendly, modern interface.
- [`{texreg}`](https://cran.r-project.org/web/packages/texreg/vignettes/texreg.pdf)
- [`{apsrtable}`](https://cran.r-project.org/web/packages/apsrtable/apsrtable.pdf)
- [`{arsenal}`](https://mayoverse.github.io/arsenal/)

I (James Hollway) would welcome any feedback on any other packages you find useful (more are being released all the time),
and which of these worked for your purposes.

### Tables from external data

In addition to the tables that can be automatically generated from data in **R**, you can also create tables directly using _pandoc_. 
This might be useful if you don't have values specifically stored in **R**, but you'd like to display them in table form.  
Below is an example.  
Pay careful attention to the alignment in the table and hyphens to create the rows and columns.
More information is available at [https://pandoc.org/README.html#tables](https://pandoc.org/README.html#tables).

----------------------------------------------------------------------------------
  Factors                    Correlation between Parents & Child      Inherited
------------------------- ----------------------------------------- --------------
  Education                                -0.49                         Yes
  
  Socio-Economic Status                     0.28                        Slight   
  
  Income                                    0.08                          No
  
  Family Size                               0.18                        Slight
  
  Occupational Prestige                     0.21                        Slight
------------------------- ----------------------------------------- --------------
Table: (\#tab:inher) Correlation of Inheritance Factors for Parents and Child 

The addition of the `(\#tab:inher)` option to the end of the table caption allows us to then make a reference to Table `\@ref(tab:label)`. 
Note that this reference could appear anywhere throughout the document after the table has appeared.  


<!--chapter:end:04-results.Rmd-->

---
title: Conclusion
author: Author
chapter: 5
in_context: False
knit: iheiddown::chapter_pdf
output: iheiddown::chapter_pdf
---

\setcounter{chapter}{4}
# Conclusion {#conclusion}

In sum, `{iheiddown}` offers an easy way to write IHEID-consistent theses,
but is enormously extensible and adaptable, 
allowing students to craft their own dissertations and other documents.

## Using iheiddown for proposals

As an example of this, let us consider how one might begin using iheiddown
from the start of a masters or doctoral dissertation,
and not just at the end while 'writing up' (a good idea in any case).

One feature often requested by supervisors from DDPs and MPTs
is the preparation of a plan about how and when the various tasks
associated with the project will be completed.
Your supervisor may even ask for this to be presented in a table or a Gantt chart.

We have covered tables in the previous chapter.
Here I want to offer a quick vignette about how you can create a Gantt chart
that outlines the temporal progression you expect to make.
We will use the `{gantrify}` package to do this.

```{r }
library("ganttrify")
ganttrify(project = ganttrify::test_project,
          project_start_date = "2020-03",
          colour_palette = iheiddown::iheid_palette("Centres", 
                                                    type = "continuous")
          )
```

## Additional resources

- [_Markdown_ Cheatsheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)

- _RMarkdown_
    - [Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)
    - [Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)
    - [For newbies](https://rbasics.netlify.com) 


- _RStudio IDE_
    - [Official website](https://rstudio.com/products/rstudio/)
    - [Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rstudio-ide.pdf)

- [`dplyr`](https://cran.rstudio.com/web/packages/dplyr/vignettes/dplyr.html)

- `ggplot2`
    - [Documentation](https://ggplot2.tidyverse.org/)
    - [Cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)

- [`bookdown`](https://bookdown.org/yihui/bookdown/)

## Anything else?

If you'd like to see examples of other things in this template, 
please add them as feature requests to the [iheiddown](https://github.com/jhollway/iheiddown) website. 
We love to see people using _RMarkdown_ for their theses, and are happy to help.

<!--chapter:end:05-conclusion.Rmd-->

# Appendix: The Echoes of the Code{-}

```{=latex}
\markboth{Appendix}{Appendix}
```

The goal of this appendix is to echo the code you used in your thesis for a greater sense of transparency and replicability of your research. 
Note that `ref.labels` can be set to any label. 
Hence, you can filter the code you want replicated in the appendix by setting labels to the desired code chunks in the various chapters. 
See [this excellent resource](https://bookdown.org/yihui/rmarkdown-cookbook/code-appendix.html) for more information.


This might be particularly useful when you perform model selection to output intermediary steps here instead of in the code to avoid cluttering your report. 

```{r get-labels, echo = FALSE}
labs <- knitr::all_labels()
labs <- setdiff(labs, c("setup", "get-labels"))
```

```{r all-code, ref.label=labs, eval=FALSE}
```

# Appendix: The Echoes of the Code redux{-}

Add as many appendices as you like.

<!--chapter:end:98-appendices.Rmd-->

`r if(!knitr:::is_latex_output()) '# References {-}'`

<!-- 
You don't really need to alter this chapter unless you want to change the name of the bibliography section 
to 'Bibliography', 'Literature', or something similar.
Any references included in the chapters will be printed here automatically.
-->

<!-- This quiet code chunk serves as a custom style for the reference section and adds a custom header. Don't change it unless you really want to. -->
```{=latex}
\markboth{References}{References}
```

<!--chapter:end:99-references.Rmd-->

---
####################
## Metadata       ##
####################
doctitle: |
  `iheiddown`: \
  A Thesis Template \
  For the Geneva Graduate Institute \
  in R Markdown
firstnames: Author
lastnames: Name
thesisno: 12345
phd: true # Or: false for Masters
department: Your Department
degreedate: June 2020
supervisor: Gandalf the Grey
secondreader: Galadriel
examiner: Aragorn II Elessar # only required if PhD; otherwise delete or comment out
# This is the YAML (YAML Ain't Markup Language) header that includes 
# metadata used to produce the document. 
# Be careful with spacing in this header!
# Two spaces at the start of the line create indentation,
# which embeds the parameter in a hierarchy.

####################
## Front Matter   ##
####################
dedication: For you #If you'd prefer to not include a Dedication, for example, simply delete the section entirely, or silence them (add # before each line). 
resume: | # otherwise known as the abstract
  `r paste(readLines("front-matter/_abstract.Rmd"), collapse = '\n  ')`
acknowledgements: |
  `r paste(readLines("front-matter/_acknowledgements.Rmd"), collapse = '\n  ')`
abbreviations: "front-matter/abbreviations" # path to .tex file with abbreviations
toc-depth: 2 # depth of heading to include in table of contents
lof: true # list of figures in front matter?
lot: true # list of tables in front matter?
mini-toc: false  # mini-table of contents at start of each chapter? (this just prepares it; you must also add \minitoc after the chapter titles)
mini-lot: false  # mini-list of tables by start of each chapter?
mini-lof: false  # mini-list of figures by start of each chapter?

####################
## Bibliography   ##
####################
bibliography: bib/references.bib #Set your bibliography file here.
bibliography-heading-in-pdf: References
bib-style: authoryear # See https://www.overleaf.com/learn/latex/biblatex_citation_styles for a list of the commonly used built-in citations styles of biblatex.
bib-sorting: nyt #See https://www.overleaf.com/learn/latex/Articles/Getting_started_with_BibLaTeX for different bibliography sorting options.
citeall: true #Set this to true if you want all elements in your .bib file to appear in your bibliography (i.e. all R-packages you used).

#####################
## PDF Formatting  ##
#####################
draft: false # add DRAFT mark in the footer and line numbering?
page-layout: oneside #'oneside' for PDF output (equal margins), 
# or 'twoside' for two-sided binding (mirror margins and blank pages) 
hidelinks: false #if false, the PDF output highlights clickable links with a colored border 
# you will probably want to set this to true for PDF version you wish to physically print
knit: iheiddown::thesis_pdf
#####################
## Output Options  ##
#####################
output: iheiddown::thesis_pdf
link-citations: true
documentclass: book
---

# Preface {.unnumbered}

<!-- 
The {.unnumbered} option here means that the introduction will be 
"Chapter 0." You can also use {-} for no numbers on chapters.
-->

<!-- This chunk creates automatically a .bib file to cite the loaded packages in the bibliography. Do not forget to set "citeall" to true in the bibliography section of the YAML header if you want all packages to be cited even if you did not mention them in the body of the text.-->

```{r, include=FALSE}
knitr::write_bib(c(.packages(), "bookdown"), "bib/packages.bib")
```


Welcome to the *RMarkdown* template for writing masters theses or PhD dissertations 
at the Geneva Graduate Institute. 
This sample content is based on the [IHEID  LaTeX dissertation template](https://github.com/jhollway/iheidmytex) and the R `bookdown` package.

But hopefully it will provide a nicer interface for those that have never used \TeX\ or \LaTeX\ before.

Using _R Markdown_ will also allow you to easily keep track of your analyses in **R** chunks of code, 
with the resulting plots and output included as well.  
The hope is this _R Markdown_ template gets you in the habit of doing reproducible research, 
which benefits you long-term as a researcher, 
but also will greatly help anyone that is trying to reproduce or build onto your results down the road.

Hopefully, you won't have much of a learning period to go through and you will reap the benefits of a nicely formatted thesis.  
The use of \LaTeX\ in combination with _Markdown_ is more consistent than the output of a word processor, 
much less prone to corruption or crashing, 
and the resulting file is smaller than a Word file. 
While you may have never had problems using Word in the past, 
your thesis is likely going to be about twice as large and complex as anything you've written before, taxing Word's capabilities.  
After working with _Markdown_ and **R** together for a few weeks, 
we are confident this will be your reporting style of choice going forward.

## Why use it? {-}

_RMarkdown_ creates a simple and straightforward way to interface with the beauty of \LaTeX\.  
Packages have been written in **R** to work directly with \LaTeX\ to produce nicely formatting tables and paragraphs. 
In addition to creating a user friendly interface to \LaTeX\, _RMarkdown_ also allows you to read in your data, to analyze it and to visualize it using **R** functions, and also to provide the documentation and commentary on the results of your project.  
Further, it allows for **R** results to be passed inline to the commentary of your results.  
You'll see more on this later.  

## Who should use it? {-}

Anyone who needs to analyses data, include lots of tables or figures, complex cross-references, mathematical equations,
or just cares about the final appearance of their document should use *RMarkdown*.
Therefore, while this template should be of particular interest to those planning to use **R** for their dissertations,
the user-friendly nature of writing _Markdown_ 
coupled with the extraordinary flexibility of \LaTeX\
(and the power of **R**)
should make *useful for everyone writing theses or dissertations at the Geneva Graduate Institute*.

<!--chapter:end:Untitled.Rmd-->

